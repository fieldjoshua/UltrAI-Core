<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraAI - Multi-LLM Orchestrator</title>
    <link rel="stylesheet" href="/css/themes.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
            color: white;
            border-radius: 12px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .orchestrator-panel {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .model-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .model-card {
            border: 2px solid var(--border-light);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }

        .model-card:hover {
            border-color: var(--primary-blue);
            background: var(--bg-primary);
        }

        .model-card.selected {
            border-color: var(--primary-blue);
            background: var(--primary-blue);
            color: white;
        }

        .model-card input[type="checkbox"] {
            margin-right: 10px;
        }

        .prompt-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .prompt-textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .execute-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .execute-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .execute-btn:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
        }

        .results-section {
            margin-top: 30px;
        }

        .result-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary-blue);
        }

        .result-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-light);
        }

        .model-name {
            font-weight: 700;
            color: var(--primary-blue);
            font-size: 1.1rem;
        }

        .result-content {
            line-height: 1.7;
            white-space: pre-wrap;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid var(--border-light);
            border-left: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            color: var(--error);
            background: #fee;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--error);
        }

        .model-count {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        .analysis-presets {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .preset-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .preset-btn:hover {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .api-status {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .api-status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .model-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>UltraAI Orchestrator</h1>
            <p>Execute prompts across multiple LLM providers simultaneously</p>
        </div>

        <div class="orchestrator-panel">
            <div id="apiStatus" class="api-status error" style="display: none;">
                ‚ö†Ô∏è API Keys not configured. The system will return demo responses showing API key errors. This is normal for the demo environment.
            </div>
            
            <h2>Multi-LLM Execution</h2>
            
            <div class="form-group">
                <label>Select LLM Models:</label>
                <div class="model-selection" id="modelSelection">
                    <div class="model-card" data-model="gpt-4">
                        <input type="checkbox" value="gpt-4" id="gpt-4">
                        <label for="gpt-4">GPT-4</label>
                        <div style="font-size: 0.8rem; color: #666;">OpenAI's most capable model</div>
                    </div>
                    <div class="model-card" data-model="gpt-3.5-turbo">
                        <input type="checkbox" value="gpt-3.5-turbo" id="gpt-3.5-turbo">
                        <label for="gpt-3.5-turbo">GPT-3.5 Turbo</label>
                        <div style="font-size: 0.8rem; color: #666;">Fast and cost-effective</div>
                    </div>
                    <div class="model-card" data-model="claude-3-opus">
                        <input type="checkbox" value="claude-3-opus" id="claude-3-opus">
                        <label for="claude-3-opus">Claude 3 Opus</label>
                        <div style="font-size: 0.8rem; color: #666;">Anthropic's most powerful model</div>
                    </div>
                    <div class="model-card" data-model="claude-3-sonnet">
                        <input type="checkbox" value="claude-3-sonnet" id="claude-3-sonnet">
                        <label for="claude-3-sonnet">Claude 3 Sonnet</label>
                        <div style="font-size: 0.8rem; color: #666;">Balanced performance</div>
                    </div>
                    <div class="model-card" data-model="claude-3-haiku">
                        <input type="checkbox" value="claude-3-haiku" id="claude-3-haiku">
                        <label for="claude-3-haiku">Claude 3 Haiku</label>
                        <div style="font-size: 0.8rem; color: #666;">Fastest Claude model</div>
                    </div>
                </div>
                <div class="model-count" id="modelCount">0 models selected</div>
            </div>

            <div class="form-group">
                <label>Analysis Type (Optional):</label>
                <div class="analysis-presets" id="analysisPresets">
                    <button type="button" class="preset-btn" data-prompt="Summarize the key points of: ">üìù Summarize</button>
                    <button type="button" class="preset-btn" data-prompt="Analyze and critique: ">üîç Analyze</button>
                    <button type="button" class="preset-btn" data-prompt="Extract the main arguments from: ">üìã Extract Key Points</button>
                    <button type="button" class="preset-btn" data-prompt="Explain in simple terms: ">üí° Explain Simply</button>
                    <button type="button" class="preset-btn" data-prompt="Find potential problems or issues with: ">‚ö†Ô∏è Find Issues</button>
                    <button type="button" class="preset-btn" data-prompt="Compare different perspectives on: ">‚öñÔ∏è Compare Views</button>
                </div>
            </div>

            <div class="form-group">
                <label for="promptInput">Enter your prompt:</label>
                <textarea id="promptInput" class="prompt-textarea" 
                    placeholder="Enter your question or topic here. You can use the analysis type buttons above or write a custom prompt..."></textarea>
            </div>

            <button id="executeBtn" class="execute-btn">
                Execute Across Selected Models
            </button>
        </div>

        <div id="resultsSection" class="results-section" style="display: none;">
            <h2>Results</h2>
            <div id="resultsContainer"></div>
        </div>
    </div>

    <script>
        class OrchestratorApp {
            constructor() {
                this.selectedModels = new Set();
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                // Model selection
                document.querySelectorAll('.model-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (e.target.type !== 'checkbox') {
                            const checkbox = card.querySelector('input[type="checkbox"]');
                            checkbox.checked = !checkbox.checked;
                        }
                        this.updateSelectedModels();
                    });
                });

                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', () => this.updateSelectedModels());
                });

                // Analysis preset buttons
                document.querySelectorAll('.preset-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const promptTemplate = btn.dataset.prompt;
                        const promptInput = document.getElementById('promptInput');
                        const currentValue = promptInput.value.trim();
                        
                        if (currentValue && !currentValue.startsWith(promptTemplate)) {
                            promptInput.value = promptTemplate + currentValue;
                        } else if (!currentValue) {
                            promptInput.value = promptTemplate;
                            promptInput.focus();
                            // Move cursor to end
                            promptInput.setSelectionRange(promptInput.value.length, promptInput.value.length);
                        }
                    });
                });

                // Execute button
                document.getElementById('executeBtn').addEventListener('click', () => this.executeOrchestrator());
                
                // Enter key in textarea
                document.getElementById('promptInput').addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        this.executeOrchestrator();
                    }
                });
            }

            updateSelectedModels() {
                this.selectedModels.clear();
                
                document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                    this.selectedModels.add(checkbox.value);
                    checkbox.closest('.model-card').classList.add('selected');
                });

                document.querySelectorAll('input[type="checkbox"]:not(:checked)').forEach(checkbox => {
                    checkbox.closest('.model-card').classList.remove('selected');
                });

                const count = this.selectedModels.size;
                document.getElementById('modelCount').textContent = 
                    count === 0 ? '0 models selected' :
                    count === 1 ? '1 model selected' :
                    `${count} models selected`;

                document.getElementById('executeBtn').disabled = count === 0;
            }

            async executeOrchestrator() {
                const prompt = document.getElementById('promptInput').value.trim();
                if (!prompt) {
                    alert('Please enter a prompt');
                    return;
                }

                if (this.selectedModels.size === 0) {
                    alert('Please select at least one model');
                    return;
                }

                const executeBtn = document.getElementById('executeBtn');
                const resultsSection = document.getElementById('resultsSection');
                const resultsContainer = document.getElementById('resultsContainer');

                executeBtn.disabled = true;
                executeBtn.textContent = 'Executing...';
                
                resultsSection.style.display = 'block';
                resultsContainer.innerHTML = '<div class="loading"><div class="spinner"></div><p>Executing across selected models...</p></div>';

                try {
                    // Execute for each selected model
                    const results = [];
                    for (const model of this.selectedModels) {
                        try {
                            const response = await fetch('/api/orchestrator/execute', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    prompt: prompt,
                                    models: [model],
                                    args: {},
                                    kwargs: {}
                                })
                            });

                            const data = await response.json();
                            
                            // Check if response contains API key error
                            let responseText = data.result.response;
                            let isApiError = false;
                            
                            if (responseText.includes('API key') || responseText.includes('invalid_request_error')) {
                                isApiError = true;
                                responseText = `‚ùå API Key Error: ${model} API key not configured in production environment.\n\nThis would normally return a real response from ${model}, but requires valid API keys to be set in the environment variables.`;
                                // Show API status warning
                                document.getElementById('apiStatus').style.display = 'block';
                            }
                            
                            results.push({
                                model: model,
                                success: !isApiError,
                                response: responseText,
                                isApiError: isApiError
                            });
                        } catch (error) {
                            results.push({
                                model: model,
                                success: false,
                                error: error.message
                            });
                        }
                    }

                    this.displayResults(results);

                } catch (error) {
                    resultsContainer.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                } finally {
                    executeBtn.disabled = false;
                    executeBtn.textContent = 'Execute Across Selected Models';
                }
            }

            displayResults(results) {
                const resultsContainer = document.getElementById('resultsContainer');
                resultsContainer.innerHTML = '';

                results.forEach(result => {
                    const resultCard = document.createElement('div');
                    resultCard.className = 'result-card';
                    
                    if (result.success) {
                        resultCard.innerHTML = `
                            <div class="result-header">
                                <div class="model-name">${result.model}</div>
                            </div>
                            <div class="result-content">${result.response}</div>
                        `;
                    } else if (result.isApiError) {
                        resultCard.innerHTML = `
                            <div class="result-header">
                                <div class="model-name">${result.model}</div>
                            </div>
                            <div class="api-status error">${result.response}</div>
                        `;
                    } else {
                        resultCard.innerHTML = `
                            <div class="result-header">
                                <div class="model-name">${result.model}</div>
                            </div>
                            <div class="error">Network Error: ${result.error || 'Unknown error occurred'}</div>
                        `;
                    }
                    
                    resultsContainer.appendChild(resultCard);
                });
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            new OrchestratorApp();
        });
    </script>
</body>
</html>