import{j as e}from"./ui-vendor-D6E6Lg3s.js";import{i as I}from"./index-5O4u9A7C.js";import{a as D}from"./react-vendor-B5BC_0HN.js";import{a as S}from"./utils-vendor-BJC98ddP.js";import{c as C}from"./state-vendor-CvCuL_CR.js";const E={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_MODE:"mock",VITE_API_URL:"https://ultrai-prod-api.onrender.com/api",VITE_DEMO_MODE:"true"},b=new Map,j=n=>{const l=b.get(n);return l?Object.fromEntries(Object.entries(l.stores).map(([s,r])=>[s,r.getState()])):{}},F=(n,l,s)=>{if(n===void 0)return{type:"untracked",connection:l.connect(s)};const r=b.get(s.name);if(r)return{type:"tracked",store:n,...r};const o={connection:l.connect(s),stores:{}};return b.set(s.name,o),{type:"tracked",store:n,...o}},$=(n,l)=>{if(l===void 0)return;const s=b.get(n);s&&(delete s.stores[l],Object.keys(s.stores).length===0&&b.delete(n))},A=n=>{var l,s;if(!n)return;const r=n.split(`
`),o=r.findIndex(u=>u.includes("api.setState"));if(o<0)return;const c=((l=r[o+1])==null?void 0:l.trim())||"";return(s=/.+ (.+) .+/.exec(c))==null?void 0:s[1]},z=(n,l={})=>(s,r,o)=>{const{enabled:c,anonymousActionType:u,store:i,...m}=l;let g;try{g=(c??(E?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!g)return n(s,r,o);const{connection:t,...p}=F(i,g,m);let x=!0;o.setState=(a,f,d)=>{const h=s(a,f);if(!x)return h;const N=d===void 0?{type:u||A(new Error().stack)||"anonymous"}:typeof d=="string"?{type:d}:d;return i===void 0?(t==null||t.send(N,r()),h):(t==null||t.send({...N,type:`${i}/${N.type}`},{...j(m.name),[i]:o.getState()}),h)},o.devtools={cleanup:()=>{t&&typeof t.unsubscribe=="function"&&t.unsubscribe(),$(m.name,i)}};const v=(...a)=>{const f=x;x=!1,s(...a),x=f},y=n(o.setState,r,o);if(p.type==="untracked"?t==null||t.init(y):(p.stores[p.store]=o,t==null||t.init(Object.fromEntries(Object.entries(p.stores).map(([a,f])=>[a,a===p.store?y:f.getState()])))),o.dispatchFromDevtools&&typeof o.dispatch=="function"){let a=!1;const f=o.dispatch;o.dispatch=(...d)=>{(E?"production":void 0)!=="production"&&d[0].type==="__setState"&&!a&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),a=!0),f(...d)}}return t.subscribe(a=>{var f;switch(a.type){case"ACTION":if(typeof a.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return w(a.payload,d=>{if(d.type==="__setState"){if(i===void 0){v(d.state);return}Object.keys(d.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const h=d.state[i];if(h==null)return;JSON.stringify(o.getState())!==JSON.stringify(h)&&v(h);return}o.dispatchFromDevtools&&typeof o.dispatch=="function"&&o.dispatch(d)});case"DISPATCH":switch(a.payload.type){case"RESET":return v(y),i===void 0?t==null?void 0:t.init(o.getState()):t==null?void 0:t.init(j(m.name));case"COMMIT":if(i===void 0){t==null||t.init(o.getState());return}return t==null?void 0:t.init(j(m.name));case"ROLLBACK":return w(a.state,d=>{if(i===void 0){v(d),t==null||t.init(o.getState());return}v(d[i]),t==null||t.init(j(m.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return w(a.state,d=>{if(i===void 0){v(d);return}JSON.stringify(o.getState())!==JSON.stringify(d[i])&&v(d[i])});case"IMPORT_STATE":{const{nextLiftedState:d}=a.payload,h=(f=d.computedStates.slice(-1)[0])==null?void 0:f.state;if(!h)return;v(i===void 0?h:h[i]),t==null||t.send(null,d);return}case"PAUSE_RECORDING":return x=!x}return}}),y},R=z,w=(n,l)=>{let s;try{s=JSON.parse(n)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}s!==void 0&&l(s)};var P,O,k;const _=((k=(O=(P=globalThis.import)==null?void 0:P.meta)==null?void 0:O.env)==null?void 0:k.VITE_API_URL)||"http://localhost:8000/api",U=C()(R((n,l)=>({documents:[],selectedDocuments:[],isLoading:!1,error:null,uploadProgress:{},fetchDocuments:async()=>{var s,r;n({isLoading:!0,error:null});try{const o=await S.get(`${_}/documents`);n({documents:o.data.documents||[],isLoading:!1})}catch(o){n({error:((r=(s=o.response)==null?void 0:s.data)==null?void 0:r.error)||"Failed to fetch documents",isLoading:!1})}},uploadDocument:async(s,r,o)=>{var i,m;const c=`${s.name}-${Date.now()}`;n({error:null});const u=new FormData;u.append("file",s),r&&u.append("description",r),o!=null&&o.length&&u.append("tags",JSON.stringify(o));try{n(t=>({uploadProgress:{...t.uploadProgress,[c]:0}}));const g=await S.post(`${_}/documents/upload`,u,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t=>{const p=t.total?Math.round(t.loaded*100/t.total):0;l().setUploadProgress(c,p)}});l().addDocument(g.data),n(t=>{const{[c]:p,...x}=t.uploadProgress;return{uploadProgress:x}})}catch(g){throw n({error:((m=(i=g.response)==null?void 0:i.data)==null?void 0:m.error)||"Failed to upload document"}),n(t=>{const{[c]:p,...x}=t.uploadProgress;return{uploadProgress:x}}),g}},deleteDocument:async s=>{var r,o;n({error:null});try{await S.delete(`${_}/documents/${s}`),l().removeDocument(s)}catch(c){throw n({error:((o=(r=c.response)==null?void 0:r.data)==null?void 0:o.error)||"Failed to delete document"}),c}},setSelectedDocuments:s=>{n({selectedDocuments:s})},toggleDocumentSelection:s=>{n(r=>({selectedDocuments:r.selectedDocuments.includes(s)?r.selectedDocuments.filter(o=>o!==s):[...r.selectedDocuments,s]}))},setUploadProgress:(s,r)=>{n(o=>({uploadProgress:{...o.uploadProgress,[s]:r}}))},clearError:()=>{n({error:null})},addDocument:s=>{n(r=>({documents:[...r.documents,s]}))},removeDocument:s=>{n(r=>({documents:r.documents.filter(o=>o.id!==s),selectedDocuments:r.selectedDocuments.filter(o=>o!==s)}))},clearDocuments:()=>{n({documents:[],selectedDocuments:[]})}}),{name:"documents-store"})),M=C()(R((n,l)=>({globalError:null,toasts:[],pendingRequests:0,setGlobalError:s=>{n({globalError:s})},showToast:(s,r="info",o=5e3)=>{const c=`${Date.now()}-${Math.random()}`,u={id:c,message:s,type:r,duration:o};n(i=>({toasts:[...i.toasts,u]})),o>0&&setTimeout(()=>{l().removeToast(c)},o)},removeToast:s=>{n(r=>({toasts:r.toasts.filter(o=>o.id!==s)}))},clearAllToasts:()=>{n({toasts:[]})},incrementPendingRequests:()=>{n(s=>({pendingRequests:s.pendingRequests+1}))},decrementPendingRequests:()=>{n(s=>({pendingRequests:Math.max(0,s.pendingRequests-1)}))},isLoading:()=>l().pendingRequests>0}),{name:"ui-store"})),L=n=>{M.getState().showToast(n,"success")},T=n=>{M.getState().showToast(n,"error")},B=()=>{const{documents:n,selectedDocuments:l,isLoading:s,error:r,fetchDocuments:o,deleteDocument:c,toggleDocumentSelection:u,clearError:i}=U();D.useEffect(()=>{o()},[o]);const m=async(t,p)=>{if(window.confirm(`Are you sure you want to delete ${p}?`))try{await c(t),L(`Successfully deleted ${p}`)}catch{T("Failed to delete document")}},g=t=>{u(t)};return s&&n.length===0?e.jsx("div",{className:"flex justify-center p-8",children:"Loading documents..."}):r?e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative my-4",children:[e.jsx("span",{className:"block sm:inline",children:r}),e.jsx("button",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:i,children:e.jsx("span",{className:"text-xl",children:"×"})})]}):n.length===0?e.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-500",children:"No documents yet"}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Upload documents to get started with analysis"})]}):e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Your Documents"}),e.jsx("div",{className:"overflow-hidden bg-white shadow sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:n.map(t=>e.jsx("li",{className:"relative",children:e.jsx("div",{className:"flex items-center px-4 py-4 sm:px-6 hover:bg-gray-50",children:e.jsxs("div",{className:"min-w-0 flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:l.includes(t.id),onChange:()=>g(t.id),"aria-label":`Select ${t.filename}`}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"flex text-sm font-medium text-indigo-600 truncate",children:t.filename}),e.jsx("div",{className:"mt-2 flex",children:e.jsx("div",{className:"flex items-center text-sm text-gray-500",children:e.jsxs("span",{children:[t.mime_type," •"," ",J(t.file_size)]})})}),e.jsxs("div",{className:"flex mt-1 items-center",children:[e.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"uploaded"}),e.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["Uploaded:"," ",new Date(t.uploaded_at).toLocaleDateString()]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"ml-2 flex gap-1",children:t.tags.map(p=>e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:p},p))})]}),t.description&&e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t.description})]})]}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsx("button",{onClick:()=>m(t.id,t.filename),className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500","aria-label":`Delete ${t.filename}`,children:"Delete"})})]})})},t.id))})}),l.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[l.length," document",l.length!==1?"s":""," selected"]})})]})},J=n=>{if(n===0)return"0 Bytes";const l=1024,s=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(n)/Math.log(l));return parseFloat((n/Math.pow(l,r)).toFixed(2))+" "+s[r]},q=()=>{const{uploadDocument:n,uploadProgress:l,error:s,clearError:r}=U(),[o,c]=D.useState(!1),[u,i]=D.useState(!1),m=D.useRef(null),g=a=>{const f=a.target.files;f&&f.length>0&&x(f[0])},t=a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?c(!0):a.type==="dragleave"&&c(!1)},p=a=>{a.preventDefault(),a.stopPropagation(),c(!1),a.dataTransfer.files&&a.dataTransfer.files.length>0&&x(a.dataTransfer.files[0])},x=async a=>{r();const f=10*1024*1024;if(a.size>f){T("File size exceeds 10MB limit");return}i(!0);try{await n(a),L(`Successfully uploaded ${a.name}`),m.current&&(m.current.value="")}catch(d){console.error("Upload failed:",d),T("Failed to upload document")}finally{i(!1)}},v=()=>{m.current&&m.current.click()},y=Object.values(l)[0]||0;return e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Upload Document"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center ${o?"border-indigo-500 bg-indigo-50":"border-gray-300 hover:border-indigo-400"}`,onDragEnter:t,onDragLeave:t,onDragOver:t,onDrop:p,children:[e.jsx("input",{type:"file",className:"hidden",ref:m,onChange:g,accept:".pdf,.doc,.docx,.txt,.md","aria-label":"Upload document"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("div",{className:"flex text-sm text-gray-600",children:e.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer",children:[e.jsx("span",{className:"text-indigo-600 hover:text-indigo-500",children:"Upload a file"}),e.jsx("span",{className:"pl-1",children:"or drag and drop"})]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"PDF, DOC, DOCX, TXT, MD up to 10MB"})]})]}),u&&y>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-indigo-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${y}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Uploading: ",y,"%"]})]}),s&&e.jsxs("div",{className:"mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[e.jsx("span",{className:"block sm:inline",children:s}),e.jsx("button",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:r,children:e.jsx("span",{className:"text-xl",children:"×"})})]}),e.jsx("button",{type:"button",onClick:v,disabled:u,className:`mt-4 w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white ${u?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}`,children:u?"Uploading...":"Select File"})]})},K=()=>I.ragEnabled?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Document Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(B,{})}),e.jsx("div",{children:e.jsx(q,{})})]})]}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Document Management"}),e.jsx("div",{className:"text-gray-600",children:"Document features are disabled."})]});export{K as default};
//# sourceMappingURL=DocumentsPage-DAQZ44o4.js.map
