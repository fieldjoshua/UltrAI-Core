{"version":3,"file":"SSEPanel-ii-FKFN7.js","sources":["../../src/components/panels/SSEPanel.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\n\ninterface SSEPanelProps {\n  correlationId: string;\n  title?: string;\n  maxEvents?: number;\n}\n\nconst SSEPanel: React.FC<SSEPanelProps> = ({\n  correlationId,\n  title = 'Live Orchestrator Events',\n  maxEvents = 100,\n}) => {\n  const [events, setEvents] = useState<\n    Array<{ time: string; event: string; payload: any }>\n  >([]);\n  const [status, setStatus] = useState<\n    'connecting' | 'open' | 'closed' | 'error'\n  >('connecting');\n  const esRef = useRef<EventSource | null>(null);\n\n  const apiBase = useMemo(\n    () => (import.meta as any).env?.VITE_API_URL || '/api',\n    []\n  );\n\n  useEffect(() => {\n    // Basic validation for correlationId to avoid malformed URLs\n    const safeId = String(correlationId || '').replace(/[^a-zA-Z0-9_\\-]/g, '');\n    if (!safeId) {\n      setStatus('error');\n      return;\n    }\n\n    const url = `${apiBase}/orchestrator/events?correlation_id=${encodeURIComponent(safeId)}`;\n    const es = new EventSource(url, { withCredentials: false });\n    esRef.current = es;\n\n    es.onopen = () => setStatus('open');\n    es.onerror = () => setStatus('error');\n    es.onmessage = (msg: MessageEvent) => {\n      try {\n        // If server uses named events, they arrive via addEventListener; also handle default message\n        const data = JSON.parse(msg.data);\n        const evtName = (data && data.event) || 'message';\n        setEvents(prev => {\n          const next = [\n            {\n              time: new Date().toISOString(),\n              event: evtName,\n              payload: data,\n            },\n            ...prev,\n          ];\n          return next.slice(0, maxEvents);\n        });\n      } catch (_e) {\n        // Fall back to raw text\n        setEvents(prev =>\n          [\n            {\n              time: new Date().toISOString(),\n              event: 'message',\n              payload: msg.data,\n            },\n            ...prev,\n          ].slice(0, maxEvents)\n        );\n      }\n    };\n\n    // Also listen to a few known named events\n    const namedEvents = [\n      'connected',\n      'analysis_start',\n      'initial_start',\n      'model_selected',\n      'model_completed',\n      'pipeline_complete',\n      'service_unavailable',\n    ];\n    namedEvents.forEach(name => {\n      es.addEventListener(name, (ev: MessageEvent) => {\n        try {\n          const data = JSON.parse(ev.data);\n          setEvents(prev =>\n            [\n              { time: new Date().toISOString(), event: name, payload: data },\n              ...prev,\n            ].slice(0, maxEvents)\n          );\n        } catch (_e) {\n          setEvents(prev =>\n            [\n              { time: new Date().toISOString(), event: name, payload: ev.data },\n              ...prev,\n            ].slice(0, maxEvents)\n          );\n        }\n      });\n    });\n\n    return () => {\n      setStatus('closed');\n      try {\n        es.close();\n      } catch {\n        /* ignore */\n      }\n      esRef.current = null;\n    };\n  }, [apiBase, correlationId, maxEvents]);\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm\">\n      <div className=\"px-4 py-2 border-b flex items-center justify-between\">\n        <div className=\"text-sm font-semibold text-gray-800\">{title}</div>\n        <div\n          className={`text-xs ${status === 'open' ? 'text-green-600' : status === 'error' ? 'text-red-600' : 'text-gray-500'}`}\n        >\n          {status}\n        </div>\n      </div>\n      <div className=\"p-3 max-h-64 overflow-auto text-xs font-mono leading-snug\">\n        {events.length === 0 ? (\n          <div className=\"text-gray-500\">\n            Waiting for events on correlation_id: {correlationId}\n          </div>\n        ) : (\n          <ul className=\"space-y-2\">\n            {events.map((e, idx) => (\n              <li key={idx} className=\"border-b pb-2\">\n                <div className=\"text-gray-600\">\n                  [{e.time}]{' '}\n                  <span className=\"font-semibold text-gray-800\">{e.event}</span>\n                </div>\n                <pre className=\"whitespace-pre-wrap break-words text-gray-800\">\n                  {typeof e.payload === 'string'\n                    ? e.payload\n                    : JSON.stringify(e.payload, null, 2)}\n                </pre>\n              </li>\n            ))}\n          </ul>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SSEPanel;\n"],"names":["SSEPanel","correlationId","title","maxEvents","events","setEvents","useState","status","setStatus","esRef","useRef","apiBase","useMemo","useEffect","safeId","url","es","msg","data","evtName","prev","name","ev","jsxs","jsx","e","idx"],"mappings":"2FAQA,MAAMA,EAAoC,CAAC,CACzC,cAAAC,EACA,MAAAC,EAAQ,2BACR,UAAAC,EAAY,GACd,IAAM,CACJ,KAAM,CAACC,EAAQC,CAAS,EAAIC,EAAAA,SAE1B,CAAA,CAAE,EACE,CAACC,EAAQC,CAAS,EAAIF,EAAAA,SAE1B,YAAY,EACRG,EAAQC,SAA2B,IAAI,EAEvCC,EAAUC,EAAA,QACd,IAAO,2CACP,CAAA,CACF,EAEAC,OAAAA,EAAAA,UAAU,IAAM,CAEd,MAAMC,EAAS,OAAOb,GAAiB,EAAE,EAAE,QAAQ,mBAAoB,EAAE,EACzE,GAAI,CAACa,EAAQ,CACXN,EAAU,OAAO,EACjB,MAAA,CAGF,MAAMO,EAAM,GAAGJ,CAAO,uCAAuC,mBAAmBG,CAAM,CAAC,GACjFE,EAAK,IAAI,YAAYD,EAAK,CAAE,gBAAiB,GAAO,EAC1D,OAAAN,EAAM,QAAUO,EAEbA,EAAA,OAAS,IAAMR,EAAU,MAAM,EAC/BQ,EAAA,QAAU,IAAMR,EAAU,OAAO,EACjCQ,EAAA,UAAaC,GAAsB,CAChC,GAAA,CAEF,MAAMC,EAAO,KAAK,MAAMD,EAAI,IAAI,EAC1BE,EAAWD,GAAQA,EAAK,OAAU,UACxCb,EAAkBe,GACH,CACX,CACE,KAAM,IAAI,KAAK,EAAE,YAAY,EAC7B,MAAOD,EACP,QAASD,CACX,EACA,GAAGE,CACL,EACY,MAAM,EAAGjB,CAAS,CAC/B,OACU,CAEXE,EACEe,GAAA,CACE,CACE,KAAM,IAAI,KAAK,EAAE,YAAY,EAC7B,MAAO,UACP,QAASH,EAAI,IACf,EACA,GAAGG,CAAA,EACH,MAAM,EAAGjB,CAAS,CACtB,CAAA,CAEJ,EAGoB,CAClB,YACA,iBACA,gBACA,iBACA,kBACA,oBACA,qBACF,EACY,QAAgBkB,GAAA,CACvBL,EAAA,iBAAiBK,EAAOC,GAAqB,CAC1C,GAAA,CACF,MAAMJ,EAAO,KAAK,MAAMI,EAAG,IAAI,EAC/BjB,EACEe,GAAA,CACE,CAAE,KAAM,IAAI,OAAO,YAAe,EAAA,MAAOC,EAAM,QAASH,CAAK,EAC7D,GAAGE,CAAA,EACH,MAAM,EAAGjB,CAAS,CACtB,OACW,CACXE,EACEe,GAAA,CACE,CAAE,KAAM,IAAI,KAAK,EAAE,YAAY,EAAG,MAAOC,EAAM,QAASC,EAAG,IAAK,EAChE,GAAGF,CAAA,EACH,MAAM,EAAGjB,CAAS,CACtB,CAAA,CACF,CACD,CAAA,CACF,EAEM,IAAM,CACXK,EAAU,QAAQ,EACd,GAAA,CACFQ,EAAG,MAAM,CAAA,MACH,CAAA,CAGRP,EAAM,QAAU,IAClB,CACC,EAAA,CAACE,EAASV,EAAeE,CAAS,CAAC,EAGnCoB,EAAA,KAAA,MAAI,CAAA,UAAU,uDACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,uDACb,SAAA,OAAC,MAAA,CAAI,UAAU,sCAAuC,SAAMrB,EAAA,EAC5DsB,EAAA,IAAC,MAAA,CACC,UAAW,WAAWjB,IAAW,OAAS,iBAAmBA,IAAW,QAAU,eAAiB,eAAe,GAEjH,SAAAA,CAAA,CAAA,CACH,EACF,EACCiB,EAAAA,IAAA,MAAI,CAAA,UAAU,4DACZ,SAAApB,EAAO,SAAW,EAChBmB,EAAA,KAAA,MAAI,CAAA,UAAU,gBAAgB,SAAA,CAAA,yCACUtB,CAAA,CACzC,CAAA,QAEC,KAAG,CAAA,UAAU,YACX,SAAAG,EAAO,IAAI,CAACqB,EAAGC,IACbH,EAAA,KAAA,KAAA,CAAa,UAAU,gBACtB,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,IAC3BE,EAAE,KAAK,IAAE,IACVD,EAAA,IAAA,OAAA,CAAK,UAAU,8BAA+B,WAAE,KAAM,CAAA,CAAA,EACzD,QACC,MAAI,CAAA,UAAU,gDACZ,SAAA,OAAOC,EAAE,SAAY,SAClBA,EAAE,QACF,KAAK,UAAUA,EAAE,QAAS,KAAM,CAAC,CACvC,CAAA,CAAA,GATOC,CAUT,CACD,CAAA,CACH,CAEJ,CAAA,CAAA,EACF,CAEJ"}