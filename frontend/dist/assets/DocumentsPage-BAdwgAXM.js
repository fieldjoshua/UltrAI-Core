import{j as s}from"./ui-vendor-D6E6Lg3s.js";import{a as D}from"./react-vendor-B5BC_0HN.js";import{a as S}from"./utils-vendor-BJC98ddP.js";import{c as C}from"./state-vendor-BeGIuX5n.js";const E={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_MODE:"mock",VITE_API_URL:"http://localhost:8000/api",VITE_DEMO_MODE:"true"},b=new Map,j=n=>{const l=b.get(n);return l?Object.fromEntries(Object.entries(l.stores).map(([t,r])=>[t,r.getState()])):{}},I=(n,l,t)=>{if(n===void 0)return{type:"untracked",connection:l.connect(t)};const r=b.get(t.name);if(r)return{type:"tracked",store:n,...r};const o={connection:l.connect(t),stores:{}};return b.set(t.name,o),{type:"tracked",store:n,...o}},F=(n,l)=>{if(l===void 0)return;const t=b.get(n);t&&(delete t.stores[l],Object.keys(t.stores).length===0&&b.delete(n))},$=n=>{var l,t;if(!n)return;const r=n.split(`
`),o=r.findIndex(u=>u.includes("api.setState"));if(o<0)return;const c=((l=r[o+1])==null?void 0:l.trim())||"";return(t=/.+ (.+) .+/.exec(c))==null?void 0:t[1]},A=(n,l={})=>(t,r,o)=>{const{enabled:c,anonymousActionType:u,store:i,...m}=l;let g;try{g=(c??(E?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!g)return n(t,r,o);const{connection:e,...p}=I(i,g,m);let x=!0;o.setState=(a,f,d)=>{const h=t(a,f);if(!x)return h;const N=d===void 0?{type:u||$(new Error().stack)||"anonymous"}:typeof d=="string"?{type:d}:d;return i===void 0?(e==null||e.send(N,r()),h):(e==null||e.send({...N,type:`${i}/${N.type}`},{...j(m.name),[i]:o.getState()}),h)},o.devtools={cleanup:()=>{e&&typeof e.unsubscribe=="function"&&e.unsubscribe(),F(m.name,i)}};const v=(...a)=>{const f=x;x=!1,t(...a),x=f},y=n(o.setState,r,o);if(p.type==="untracked"?e==null||e.init(y):(p.stores[p.store]=o,e==null||e.init(Object.fromEntries(Object.entries(p.stores).map(([a,f])=>[a,a===p.store?y:f.getState()])))),o.dispatchFromDevtools&&typeof o.dispatch=="function"){let a=!1;const f=o.dispatch;o.dispatch=(...d)=>{(E?"production":void 0)!=="production"&&d[0].type==="__setState"&&!a&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),a=!0),f(...d)}}return e.subscribe(a=>{var f;switch(a.type){case"ACTION":if(typeof a.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return w(a.payload,d=>{if(d.type==="__setState"){if(i===void 0){v(d.state);return}Object.keys(d.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const h=d.state[i];if(h==null)return;JSON.stringify(o.getState())!==JSON.stringify(h)&&v(h);return}o.dispatchFromDevtools&&typeof o.dispatch=="function"&&o.dispatch(d)});case"DISPATCH":switch(a.payload.type){case"RESET":return v(y),i===void 0?e==null?void 0:e.init(o.getState()):e==null?void 0:e.init(j(m.name));case"COMMIT":if(i===void 0){e==null||e.init(o.getState());return}return e==null?void 0:e.init(j(m.name));case"ROLLBACK":return w(a.state,d=>{if(i===void 0){v(d),e==null||e.init(o.getState());return}v(d[i]),e==null||e.init(j(m.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return w(a.state,d=>{if(i===void 0){v(d);return}JSON.stringify(o.getState())!==JSON.stringify(d[i])&&v(d[i])});case"IMPORT_STATE":{const{nextLiftedState:d}=a.payload,h=(f=d.computedStates.slice(-1)[0])==null?void 0:f.state;if(!h)return;v(i===void 0?h:h[i]),e==null||e.send(null,d);return}case"PAUSE_RECORDING":return x=!x}return}}),y},R=A,w=(n,l)=>{let t;try{t=JSON.parse(n)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}t!==void 0&&l(t)};var P,O,k;const _=((k=(O=(P=globalThis.import)==null?void 0:P.meta)==null?void 0:O.env)==null?void 0:k.VITE_API_URL)||"http://localhost:8000/api",U=C()(R((n,l)=>({documents:[],selectedDocuments:[],isLoading:!1,error:null,uploadProgress:{},fetchDocuments:async()=>{var t,r;n({isLoading:!0,error:null});try{const o=await S.get(`${_}/documents`);n({documents:o.data.documents||[],isLoading:!1})}catch(o){n({error:((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.error)||"Failed to fetch documents",isLoading:!1})}},uploadDocument:async(t,r,o)=>{var i,m;const c=`${t.name}-${Date.now()}`;n({error:null});const u=new FormData;u.append("file",t),r&&u.append("description",r),o!=null&&o.length&&u.append("tags",JSON.stringify(o));try{n(e=>({uploadProgress:{...e.uploadProgress,[c]:0}}));const g=await S.post(`${_}/documents/upload`,u,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{const p=e.total?Math.round(e.loaded*100/e.total):0;l().setUploadProgress(c,p)}});l().addDocument(g.data),n(e=>{const{[c]:p,...x}=e.uploadProgress;return{uploadProgress:x}})}catch(g){throw n({error:((m=(i=g.response)==null?void 0:i.data)==null?void 0:m.error)||"Failed to upload document"}),n(e=>{const{[c]:p,...x}=e.uploadProgress;return{uploadProgress:x}}),g}},deleteDocument:async t=>{var r,o;n({error:null});try{await S.delete(`${_}/documents/${t}`),l().removeDocument(t)}catch(c){throw n({error:((o=(r=c.response)==null?void 0:r.data)==null?void 0:o.error)||"Failed to delete document"}),c}},setSelectedDocuments:t=>{n({selectedDocuments:t})},toggleDocumentSelection:t=>{n(r=>({selectedDocuments:r.selectedDocuments.includes(t)?r.selectedDocuments.filter(o=>o!==t):[...r.selectedDocuments,t]}))},setUploadProgress:(t,r)=>{n(o=>({uploadProgress:{...o.uploadProgress,[t]:r}}))},clearError:()=>{n({error:null})},addDocument:t=>{n(r=>({documents:[...r.documents,t]}))},removeDocument:t=>{n(r=>({documents:r.documents.filter(o=>o.id!==t),selectedDocuments:r.selectedDocuments.filter(o=>o!==t)}))},clearDocuments:()=>{n({documents:[],selectedDocuments:[]})}}),{name:"documents-store"})),L=C()(R((n,l)=>({globalError:null,toasts:[],pendingRequests:0,setGlobalError:t=>{n({globalError:t})},showToast:(t,r="info",o=5e3)=>{const c=`${Date.now()}-${Math.random()}`,u={id:c,message:t,type:r,duration:o};n(i=>({toasts:[...i.toasts,u]})),o>0&&setTimeout(()=>{l().removeToast(c)},o)},removeToast:t=>{n(r=>({toasts:r.toasts.filter(o=>o.id!==t)}))},clearAllToasts:()=>{n({toasts:[]})},incrementPendingRequests:()=>{n(t=>({pendingRequests:t.pendingRequests+1}))},decrementPendingRequests:()=>{n(t=>({pendingRequests:Math.max(0,t.pendingRequests-1)}))},isLoading:()=>l().pendingRequests>0}),{name:"ui-store"})),M=n=>{L.getState().showToast(n,"success")},T=n=>{L.getState().showToast(n,"error")},z=()=>{const{documents:n,selectedDocuments:l,isLoading:t,error:r,fetchDocuments:o,deleteDocument:c,toggleDocumentSelection:u,clearError:i}=U();D.useEffect(()=>{o()},[o]);const m=async(e,p)=>{if(window.confirm(`Are you sure you want to delete ${p}?`))try{await c(e),M(`Successfully deleted ${p}`)}catch{T("Failed to delete document")}},g=e=>{u(e)};return t&&n.length===0?s.jsx("div",{className:"flex justify-center p-8",children:"Loading documents..."}):r?s.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative my-4",children:[s.jsx("span",{className:"block sm:inline",children:r}),s.jsx("button",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:i,children:s.jsx("span",{className:"text-xl",children:"×"})})]}):n.length===0?s.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-500",children:"No documents yet"}),s.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Upload documents to get started with analysis"})]}):s.jsxs("div",{className:"mt-4",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Your Documents"}),s.jsx("div",{className:"overflow-hidden bg-white shadow sm:rounded-md",children:s.jsx("ul",{className:"divide-y divide-gray-200",children:n.map(e=>s.jsx("li",{className:"relative",children:s.jsx("div",{className:"flex items-center px-4 py-4 sm:px-6 hover:bg-gray-50",children:s.jsxs("div",{className:"min-w-0 flex-1 sm:flex sm:items-center sm:justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:l.includes(e.id),onChange:()=>g(e.id),"aria-label":`Select ${e.filename}`}),s.jsxs("div",{className:"ml-4",children:[s.jsx("div",{className:"flex text-sm font-medium text-indigo-600 truncate",children:e.filename}),s.jsx("div",{className:"mt-2 flex",children:s.jsx("div",{className:"flex items-center text-sm text-gray-500",children:s.jsxs("span",{children:[e.mime_type," •"," ",B(e.file_size)]})})}),s.jsxs("div",{className:"flex mt-1 items-center",children:[s.jsx("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"uploaded"}),s.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["Uploaded:"," ",new Date(e.uploaded_at).toLocaleDateString()]}),e.tags&&e.tags.length>0&&s.jsx("div",{className:"ml-2 flex gap-1",children:e.tags.map(p=>s.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:p},p))})]}),e.description&&s.jsx("p",{className:"mt-1 text-sm text-gray-600",children:e.description})]})]}),s.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:s.jsx("button",{onClick:()=>m(e.id,e.filename),className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500","aria-label":`Delete ${e.filename}`,children:"Delete"})})]})})},e.id))})}),l.length>0&&s.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:s.jsxs("p",{className:"text-sm text-blue-700",children:[l.length," document",l.length!==1?"s":""," selected"]})})]})},B=n=>{if(n===0)return"0 Bytes";const l=1024,t=["Bytes","KB","MB","GB","TB"],r=Math.floor(Math.log(n)/Math.log(l));return parseFloat((n/Math.pow(l,r)).toFixed(2))+" "+t[r]},J=()=>{const{uploadDocument:n,uploadProgress:l,error:t,clearError:r}=U(),[o,c]=D.useState(!1),[u,i]=D.useState(!1),m=D.useRef(null),g=a=>{const f=a.target.files;f&&f.length>0&&x(f[0])},e=a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?c(!0):a.type==="dragleave"&&c(!1)},p=a=>{a.preventDefault(),a.stopPropagation(),c(!1),a.dataTransfer.files&&a.dataTransfer.files.length>0&&x(a.dataTransfer.files[0])},x=async a=>{r();const f=10*1024*1024;if(a.size>f){T("File size exceeds 10MB limit");return}i(!0);try{await n(a),M(`Successfully uploaded ${a.name}`),m.current&&(m.current.value="")}catch(d){console.error("Upload failed:",d),T("Failed to upload document")}finally{i(!1)}},v=()=>{m.current&&m.current.click()},y=Object.values(l)[0]||0;return s.jsxs("div",{className:"mt-4",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Upload Document"}),s.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center ${o?"border-indigo-500 bg-indigo-50":"border-gray-300 hover:border-indigo-400"}`,onDragEnter:e,onDragLeave:e,onDragOver:e,onDrop:p,children:[s.jsx("input",{type:"file",className:"hidden",ref:m,onChange:g,accept:".pdf,.doc,.docx,.txt,.md","aria-label":"Upload document"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),s.jsx("div",{className:"flex text-sm text-gray-600",children:s.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer",children:[s.jsx("span",{className:"text-indigo-600 hover:text-indigo-500",children:"Upload a file"}),s.jsx("span",{className:"pl-1",children:"or drag and drop"})]})}),s.jsx("p",{className:"text-xs text-gray-500",children:"PDF, DOC, DOCX, TXT, MD up to 10MB"})]})]}),u&&y>0&&s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:s.jsx("div",{className:"bg-indigo-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${y}%`}})}),s.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Uploading: ",y,"%"]})]}),t&&s.jsxs("div",{className:"mt-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[s.jsx("span",{className:"block sm:inline",children:t}),s.jsx("button",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:r,children:s.jsx("span",{className:"text-xl",children:"×"})})]}),s.jsx("button",{type:"button",onClick:v,disabled:u,className:`mt-4 w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white ${u?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}`,children:u?"Uploading...":"Select File"})]})},W=()=>s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Document Management"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[s.jsx("div",{className:"md:col-span-2",children:s.jsx(z,{})}),s.jsx("div",{children:s.jsx(J,{})})]})]});export{W as default};
//# sourceMappingURL=DocumentsPage-BAdwgAXM.js.map
