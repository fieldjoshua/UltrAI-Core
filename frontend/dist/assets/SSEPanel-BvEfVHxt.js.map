{"version":3,"file":"SSEPanel-BvEfVHxt.js","sources":["../../src/components/panels/SSEPanel.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\n\ninterface SSEPanelProps {\n  correlationId: string;\n  title?: string;\n  maxEvents?: number;\n}\n\nconst SSEPanel: React.FC<SSEPanelProps> = ({ correlationId, title = 'Live Orchestrator Events', maxEvents = 100 }) => {\n  const [events, setEvents] = useState<Array<{ time: string; event: string; payload: any }>>([]);\n  const [status, setStatus] = useState<'connecting' | 'open' | 'closed' | 'error'>('connecting');\n  const esRef = useRef<EventSource | null>(null);\n\n  const apiBase = useMemo(() => (import.meta as any).env?.VITE_API_URL || '/api', []);\n\n  useEffect(() => {\n    // Basic validation for correlationId to avoid malformed URLs\n    const safeId = String(correlationId || '').replace(/[^a-zA-Z0-9_\\-]/g, '');\n    if (!safeId) {\n      setStatus('error');\n      return;\n    }\n\n    const url = `${apiBase}/orchestrator/events?correlation_id=${encodeURIComponent(safeId)}`;\n    const es = new EventSource(url, { withCredentials: false });\n    esRef.current = es;\n\n    es.onopen = () => setStatus('open');\n    es.onerror = () => setStatus('error');\n    es.onmessage = (msg: MessageEvent) => {\n      try {\n        // If server uses named events, they arrive via addEventListener; also handle default message\n        const data = JSON.parse(msg.data);\n        const evtName = (data && data.event) || 'message';\n        setEvents(prev => {\n          const next = [\n            {\n              time: new Date().toISOString(),\n              event: evtName,\n              payload: data,\n            },\n            ...prev,\n          ];\n          return next.slice(0, maxEvents);\n        });\n      } catch (_e) {\n        // Fall back to raw text\n        setEvents(prev => [{ time: new Date().toISOString(), event: 'message', payload: msg.data }, ...prev].slice(0, maxEvents));\n      }\n    };\n\n    // Also listen to a few known named events\n    const namedEvents = ['connected', 'analysis_start', 'initial_start', 'model_selected', 'model_completed', 'pipeline_complete', 'service_unavailable'];\n    namedEvents.forEach(name => {\n      es.addEventListener(name, (ev: MessageEvent) => {\n        try {\n          const data = JSON.parse(ev.data);\n          setEvents(prev => [{ time: new Date().toISOString(), event: name, payload: data }, ...prev].slice(0, maxEvents));\n        } catch (_e) {\n          setEvents(prev => [{ time: new Date().toISOString(), event: name, payload: ev.data }, ...prev].slice(0, maxEvents));\n        }\n      });\n    });\n\n    return () => {\n      setStatus('closed');\n      try { es.close(); } catch { /* ignore */ }\n      esRef.current = null;\n    };\n  }, [apiBase, correlationId, maxEvents]);\n\n  return (\n    <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm\">\n      <div className=\"px-4 py-2 border-b flex items-center justify-between\">\n        <div className=\"text-sm font-semibold text-gray-800\">{title}</div>\n        <div className={`text-xs ${status === 'open' ? 'text-green-600' : status === 'error' ? 'text-red-600' : 'text-gray-500'}`}>{status}</div>\n      </div>\n      <div className=\"p-3 max-h-64 overflow-auto text-xs font-mono leading-snug\">\n        {events.length === 0 ? (\n          <div className=\"text-gray-500\">Waiting for events on correlation_id: {correlationId}</div>\n        ) : (\n          <ul className=\"space-y-2\">\n            {events.map((e, idx) => (\n              <li key={idx} className=\"border-b pb-2\">\n                <div className=\"text-gray-600\">[{e.time}] <span className=\"font-semibold text-gray-800\">{e.event}</span></div>\n                <pre className=\"whitespace-pre-wrap break-words text-gray-800\">{typeof e.payload === 'string' ? e.payload : JSON.stringify(e.payload, null, 2)}</pre>\n              </li>) )}\n          </ul>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SSEPanel;\n"],"names":["SSEPanel","correlationId","title","maxEvents","events","setEvents","useState","status","setStatus","esRef","useRef","apiBase","useMemo","useEffect","safeId","url","es","msg","data","evtName","prev","name","ev","jsxs","jsx","e","idx"],"mappings":"+CAQM,MAAAA,EAAoC,CAAC,CAAE,cAAAC,EAAe,MAAAC,EAAQ,2BAA4B,UAAAC,EAAY,OAAU,CACpH,KAAM,CAACC,EAAQC,CAAS,EAAIC,EAAAA,SAA+D,CAAA,CAAE,EACvF,CAACC,EAAQC,CAAS,EAAIF,EAAAA,SAAqD,YAAY,EACvFG,EAAQC,SAA2B,IAAI,EAEvCC,EAAUC,EAAAA,QAAQ,IAAO,uCAAiD,CAAA,CAAE,EAElFC,OAAAA,EAAAA,UAAU,IAAM,CAEd,MAAMC,EAAS,OAAOb,GAAiB,EAAE,EAAE,QAAQ,mBAAoB,EAAE,EACzE,GAAI,CAACa,EAAQ,CACXN,EAAU,OAAO,EACjB,MAAA,CAGF,MAAMO,EAAM,GAAGJ,CAAO,uCAAuC,mBAAmBG,CAAM,CAAC,GACjFE,EAAK,IAAI,YAAYD,EAAK,CAAE,gBAAiB,GAAO,EAC1D,OAAAN,EAAM,QAAUO,EAEbA,EAAA,OAAS,IAAMR,EAAU,MAAM,EAC/BQ,EAAA,QAAU,IAAMR,EAAU,OAAO,EACjCQ,EAAA,UAAaC,GAAsB,CAChC,GAAA,CAEF,MAAMC,EAAO,KAAK,MAAMD,EAAI,IAAI,EAC1BE,EAAWD,GAAQA,EAAK,OAAU,UACxCb,EAAkBe,GACH,CACX,CACE,KAAM,IAAI,KAAK,EAAE,YAAY,EAC7B,MAAOD,EACP,QAASD,CACX,EACA,GAAGE,CACL,EACY,MAAM,EAAGjB,CAAS,CAC/B,OACU,CAEDE,EAAAe,GAAQ,CAAC,CAAE,KAAU,IAAA,KAAA,EAAO,YAAA,EAAe,MAAO,UAAW,QAASH,EAAI,MAAQ,GAAGG,CAAI,EAAE,MAAM,EAAGjB,CAAS,CAAC,CAAA,CAE5H,EAGoB,CAAC,YAAa,iBAAkB,gBAAiB,iBAAkB,kBAAmB,oBAAqB,qBAAqB,EACxI,QAAgBkB,GAAA,CACvBL,EAAA,iBAAiBK,EAAOC,GAAqB,CAC1C,GAAA,CACF,MAAMJ,EAAO,KAAK,MAAMI,EAAG,IAAI,EACrBjB,EAAAe,GAAQ,CAAC,CAAE,KAAU,IAAA,KAAA,EAAO,cAAe,MAAOC,EAAM,QAASH,GAAQ,GAAGE,CAAI,EAAE,MAAM,EAAGjB,CAAS,CAAC,OACpG,CACDE,EAAAe,GAAQ,CAAC,CAAE,KAAU,IAAA,KAAA,EAAO,YAAA,EAAe,MAAOC,EAAM,QAASC,EAAG,MAAQ,GAAGF,CAAI,EAAE,MAAM,EAAGjB,CAAS,CAAC,CAAA,CACpH,CACD,CAAA,CACF,EAEM,IAAM,CACXK,EAAU,QAAQ,EACd,GAAA,CAAEQ,EAAG,MAAM,CAAA,MAAW,CAAA,CAC1BP,EAAM,QAAU,IAClB,CACC,EAAA,CAACE,EAASV,EAAeE,CAAS,CAAC,EAGnCoB,EAAA,KAAA,MAAI,CAAA,UAAU,uDACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,uDACb,SAAA,OAAC,MAAA,CAAI,UAAU,sCAAuC,SAAMrB,EAAA,EAC3DsB,EAAA,IAAA,MAAA,CAAI,UAAW,WAAWjB,IAAW,OAAS,iBAAmBA,IAAW,QAAU,eAAiB,eAAe,GAAK,SAAOA,CAAA,CAAA,CAAA,EACrI,EACCiB,EAAAA,IAAA,MAAI,CAAA,UAAU,4DACZ,SAAApB,EAAO,SAAW,EAChBmB,EAAA,KAAA,MAAI,CAAA,UAAU,gBAAgB,SAAA,CAAA,yCAAuCtB,CAAA,CAAc,CAAA,QAEnF,KAAG,CAAA,UAAU,YACX,SAAAG,EAAO,IAAI,CAACqB,EAAGC,IACbH,EAAA,KAAA,KAAA,CAAa,UAAU,gBACtB,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,gBAAgB,SAAA,CAAA,IAAEE,EAAE,KAAK,KAAGD,EAAA,IAAA,OAAA,CAAK,UAAU,8BAA+B,WAAE,KAAM,CAAA,CAAA,EAAO,QACvG,MAAI,CAAA,UAAU,gDAAiD,SAAA,OAAOC,EAAE,SAAY,SAAWA,EAAE,QAAU,KAAK,UAAUA,EAAE,QAAS,KAAM,CAAC,CAAE,CAAA,CAAA,GAFxIC,CAGT,CAAO,CAAA,CACX,CAEJ,CAAA,CAAA,EACF,CAEJ"}