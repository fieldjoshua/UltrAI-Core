# Render configuration for STAGING environment
# Service: ultrai-staging-api.onrender.com

services:
  - type: web
    name: ultrai-staging-api
    runtime: python
    plan: free
    buildCommand: pip install -r requirements-production.txt
    startCommand: python app_production.py
    
    # Auto-deploy from main branch
    branch: main
    autoDeploy: true
    
    # Health check
    healthCheckPath: /api/health
    
    envVars:
      # Core configuration
      - key: ENVIRONMENT
        value: staging
      - key: DEBUG
        value: "true"
      
      # Disable financial features for staging
      - key: ENABLE_BILLING
        value: "false"
      - key: ENABLE_PRICING
        value: "false"
      - key: ENABLE_AUTH
        value: "false"
      - key: ENABLE_RATE_LIMIT
        value: "false"
      
      # Core service configuration
      - key: RAG_ENABLED
        value: "false"
      - key: MINIMUM_MODELS_REQUIRED
        value: "3"
      - key: ENABLE_SINGLE_MODEL_FALLBACK
        value: "false"
      
      # LLM API Keys (copy from production)
      - key: OPENAI_API_KEY
        sync: false
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: GOOGLE_API_KEY
        sync: false
      - key: HUGGINGFACE_API_KEY
        sync: false
      
      # Database
      - key: DATABASE_URL
        fromDatabase:
          name: ultrai-staging-db
          property: connectionString
      
      # CORS
      - key: CORS_ORIGINS
        value: "https://staging-ultrai.onrender.com,https://ultrai-staging-api.onrender.com,http://localhost:5173,http://localhost:3009"

# Database configuration
databases:
  - name: ultrai-staging-db
    plan: free
    databaseName: ultrai_staging
    user: ultrai_staging_user
    postgresMajorVersion: "15"